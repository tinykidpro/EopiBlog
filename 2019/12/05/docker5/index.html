<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>5. Network trong docker | Eopi Blog</title><meta name="description" content="5. Network trong docker"><meta name="keywords" content="Docker,Virtual Machine"><meta name="author" content="Eopi Noriko"><meta name="copyright" content="Eopi Noriko"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="5. Network trong docker"><meta name="twitter:description" content="5. Network trong docker"><meta name="twitter:image" content="https://eopi.loliteam.net/img/docker.png"><meta property="og:type" content="article"><meta property="og:title" content="5. Network trong docker"><meta property="og:url" content="https://eopi.loliteam.net/2019/12/05/docker5/"><meta property="og:site_name" content="Eopi Blog"><meta property="og:description" content="5. Network trong docker"><meta property="og:image" content="https://eopi.loliteam.net/img/docker.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.css"><link rel="canonical" href="https://eopi.loliteam.net/2019/12/05/docker5/"><link rel="prev" title="6. Viết docker-compose để khởi chạy multi container" href="/https:/eopi.loliteam.net/2019/12/05/docker6/"><link rel="next" title="4. Viết dockerfile để build image" href="/https:/eopi.loliteam.net/2019/12/05/docker4/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"Chúng tôi không tìm thấy bất kỳ kết quả nào cho tìm kiếm: ${query}"}},
  translate: undefined,
  highlight_copy: 'true',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: 'Sao chép thành công',
    error: 'Sao chép lỗi',
    noSupport: 'Trình duyệt không hỗ trợ'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Nhấn',
    message_next: 'để đánh dấu trang này'
  },
  runtime_unit: 'days',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: {"text":"Eopi,LoLi,Shiina","fontSize":"15px"},
  medium_zoom: 'true',
  Snackbar: {"bookmark":{"title":"Snackbar.bookmark.title","message_prev":"Nhấn","message_next":"để đánh dấu trang này"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Light Mode Activated Manually","night_to_day":"Dark Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"}
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Eopi Blog</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> Search</span></a></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">14</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">9</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Mục lục</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Network-trong-Docker"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Network trong Docker.</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#1-Default-network"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">1. Default network</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-1-None-network"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">1.1 None network</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-2-Bridge"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">1.2 Bridge</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#1-3-Host"><span class="toc_mobile_items-number">2.3.</span> <span class="toc_mobile_items-text">1.3 Host</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#2-User-defined-networks"><span class="toc_mobile_items-number">2.4.</span> <span class="toc_mobile_items-text">2. User-defined networks</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#3-An-overlay-network-with-Docker-Engine-swarm-mode"><span class="toc_mobile_items-number">2.5.</span> <span class="toc_mobile_items-text">3. An overlay network with Docker Engine swarm mode</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#4-“Noi-chuyen”-giua-cac-container-voi-nhau"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">4. “Nói chuyện” giữa các container với nhau.</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-1-Truong-hop-su-dung-default-bridge-network-de-ket-noi-cac-container"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">4.1 Trường hợp sử dụng default bridge network để kết nối các container</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#4-2-Truong-hop-su-dung-user-defined-bridge-network-de-ket-noi-cac-container"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">4.2 Trường hợp sử dụng user-defined bridge network để kết nối các container</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#5-DNS-server"><span class="toc_mobile_items-number">3.3.</span> <span class="toc_mobile_items-text">5. DNS server.</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-1-Default-bridge-network"><span class="toc_mobile_items-number">3.3.1.</span> <span class="toc_mobile_items-text">5.1 Default bridge network</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-2-User-defined-networks"><span class="toc_mobile_items-number">3.3.2.</span> <span class="toc_mobile_items-text">5.2 User-defined networks</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-3-Chi-dinh-su-dung-dns-server-rieng"><span class="toc_mobile_items-number">3.3.3.</span> <span class="toc_mobile_items-text">5.3 Chỉ định sử dụng dns-server riêng</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#6-MacVlan"><span class="toc_mobile_items-number">3.4.</span> <span class="toc_mobile_items-text">6. MacVlan.</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#LAB-macvlan-che-do-bridge"><span class="toc_mobile_items-number">3.4.0.1.</span> <span class="toc_mobile_items-text">LAB macvlan chế độ bridge</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#LAB-macvlan-che-do-bridge-tinh-nang-vlan"><span class="toc_mobile_items-number">3.4.0.2.</span> <span class="toc_mobile_items-text">LAB macvlan chế độ bridge tính năng vlan</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#Kiem-tra"><span class="toc_mobile_items-number">3.4.0.2.1.</span> <span class="toc_mobile_items-text">Kiểm tra</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Tao-multi-subnet-tren-cung-1-sub-interface"><span class="toc_mobile_items-number">3.4.0.3.</span> <span class="toc_mobile_items-text">Tạo multi-subnet trên cùng 1 sub-interface:</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#7-Ipvlan"><span class="toc_mobile_items-number">3.5.</span> <span class="toc_mobile_items-text">7. Ipvlan</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Lab-ipvlan-L3-Multi-Subnet-Ipvlan-L3-Network"><span class="toc_mobile_items-number">3.5.0.1.</span> <span class="toc_mobile_items-text">Lab ipvlan L3: Multi-Subnet Ipvlan L3 Network</span></a></li></ol></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Reference"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">Reference</span></a></li></ol></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Mục lục</div><div class="sidebar-toc__progress"><span class="progress-notice">Bạn đã đọc</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Network-trong-Docker"><span class="toc-number">1.</span> <span class="toc-text">Network trong Docker.</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Default-network"><span class="toc-number">2.</span> <span class="toc-text">1. Default network</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-None-network"><span class="toc-number">2.1.</span> <span class="toc-text">1.1 None network</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Bridge"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 Bridge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-Host"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 Host</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-User-defined-networks"><span class="toc-number">2.4.</span> <span class="toc-text">2. User-defined networks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-An-overlay-network-with-Docker-Engine-swarm-mode"><span class="toc-number">2.5.</span> <span class="toc-text">3. An overlay network with Docker Engine swarm mode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-“Noi-chuyen”-giua-cac-container-voi-nhau"><span class="toc-number">3.</span> <span class="toc-text">4. “Nói chuyện” giữa các container với nhau.</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-Truong-hop-su-dung-default-bridge-network-de-ket-noi-cac-container"><span class="toc-number">3.1.</span> <span class="toc-text">4.1 Trường hợp sử dụng default bridge network để kết nối các container</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-Truong-hop-su-dung-user-defined-bridge-network-de-ket-noi-cac-container"><span class="toc-number">3.2.</span> <span class="toc-text">4.2 Trường hợp sử dụng user-defined bridge network để kết nối các container</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-DNS-server"><span class="toc-number">3.3.</span> <span class="toc-text">5. DNS server.</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Default-bridge-network"><span class="toc-number">3.3.1.</span> <span class="toc-text">5.1 Default bridge network</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-User-defined-networks"><span class="toc-number">3.3.2.</span> <span class="toc-text">5.2 User-defined networks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Chi-dinh-su-dung-dns-server-rieng"><span class="toc-number">3.3.3.</span> <span class="toc-text">5.3 Chỉ định sử dụng dns-server riêng</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-MacVlan"><span class="toc-number">3.4.</span> <span class="toc-text">6. MacVlan.</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-macvlan-che-do-bridge"><span class="toc-number">3.4.0.1.</span> <span class="toc-text">LAB macvlan chế độ bridge</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LAB-macvlan-che-do-bridge-tinh-nang-vlan"><span class="toc-number">3.4.0.2.</span> <span class="toc-text">LAB macvlan chế độ bridge tính năng vlan</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Kiem-tra"><span class="toc-number">3.4.0.2.1.</span> <span class="toc-text">Kiểm tra</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Tao-multi-subnet-tren-cung-1-sub-interface"><span class="toc-number">3.4.0.3.</span> <span class="toc-text">Tạo multi-subnet trên cùng 1 sub-interface:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Ipvlan"><span class="toc-number">3.5.</span> <span class="toc-text">7. Ipvlan</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Lab-ipvlan-L3-Multi-Subnet-Ipvlan-L3-Network"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">Lab ipvlan L3: Multi-Subnet Ipvlan L3 Network</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Reference"><span class="toc-number">4.</span> <span class="toc-text">Reference</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/docker.png)"><div id="post-info"><div id="post-title"><div class="posttitle">5. Network trong docker</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> Created 2019-12-05<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> Updated 2019-12-05</time><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>Post View: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Network-trong-Docker"><a href="#Network-trong-Docker" class="headerlink" title="Network trong Docker."></a>Network trong Docker.</h1><p><img alt data-src="https://camo.githubusercontent.com/d2c856d1986260ace4a29c8478e17bba09dacc13/687474703a2f2f692e696d6775722e636f6d2f614e534a3639792e706e67" class="lazyload"></p>
<p>Khi chúng ta cài đặt Docker, những thiết lập sau sẽ được thực hiện:</p>
<ul>
<li>Virtual bridge docker0 sẽ được tạo ra</li>
<li>Docker tìm một subnet chưa được dùng trên host và gán một địa chỉ cho docker0</li>
</ul>
<p>Sau đó, khi chúng ta khởi động một container (với bridge network), một veth (Virtual Ethernet) sẽ được tạo ra nối 1 đầu với docker0 và một đầu sẽ được nối với interface eth0 trên container.</p>
<h1 id="1-Default-network"><a href="#1-Default-network" class="headerlink" title="1. Default network"></a>1. Default network</h1><p>Mặc định khi cài đặt xong, Docker sẽ tạo ra 3 card mạng mặc định là:</p>
<ul>
<li><p>bridge</p>
</li>
<li><p>host</p>
</li>
<li><p>only.</p>
</li>
<li><p>Tương ứng với các nền tảo ảo hóa khác, ta có các chế độ card mạng của docker so với các nền tảng đấy là:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>General Virtualization Term</th>
<th>Docker Network Driver</th>
</tr>
</thead>
<tbody><tr>
<td>NAT Network</td>
<td>bridge</td>
</tr>
<tr>
<td>Bridged</td>
<td>macvlan, ipvlan (experimental since Docker 1.11)</td>
</tr>
<tr>
<td>Private / Host-only</td>
<td>bridge</td>
</tr>
<tr>
<td>Overlay Network / VXLAN</td>
<td>overlay</td>
</tr>
</tbody></table>
<p>Để xem chi tiết, ta có thể dùng lệnh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker network ls</span></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@adk:/<span class="comment"># docker network ls</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">1d8aa8d520a2        bridge              bridge              <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">a8ddedeecca8        host                host                <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">ad1c5f949ef2        none                null                <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">root@adk:/<span class="comment">#</span></span></pre></td></tr></table></figure>

<p>Mặc định khi tạo container mà ta không chỉ định dùng network nào, thì docker sẽ dùng dải bridge.</p>
<h2 id="1-1-None-network"><a href="#1-1-None-network" class="headerlink" title="1.1 None network"></a>1.1 None network</h2><p>Các container thiết lập network này sẽ không được cấu hình mạng. </p>
<h2 id="1-2-Bridge"><a href="#1-2-Bridge" class="headerlink" title="1.2 Bridge"></a>1.2 Bridge</h2><p>Docker sẽ tạo ra một switch ảo. Khi container được tạo ra, interface của container sẽ gắn vào switch ảo này và kết nối với interface của host.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@adk:~<span class="comment"># docker network inspect bridge</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">[</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Name"</span>: <span class="string">"bridge"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Id"</span>: <span class="string">"1d8aa8d520a2775b5f02279e2ff057e2d781a67e116e603d367edab58211a5d9"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Created"</span>: <span class="string">"2017-03-14T09:35:39.561628223+07:00"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Scope"</span>: <span class="string">"local"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Driver"</span>: <span class="string">"bridge"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"EnableIPv6"</span>: <span class="literal">false</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"IPAM"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"Driver"</span>: <span class="string">"default"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"Options"</span>: null,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"Config"</span>: [</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">                &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">                    <span class="string">"Subnet"</span>: <span class="string">"172.17.0.0/16"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">                    <span class="string">"Gateway"</span>: <span class="string">"172.17.0.1"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">                &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            ]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Internal"</span>: <span class="literal">false</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Attachable"</span>: <span class="literal">false</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Containers"</span>: &#123;&#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Options"</span>: &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.bridge.default_bridge"</span>: <span class="string">"true"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.bridge.enable_icc"</span>: <span class="string">"true"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.bridge.enable_ip_masquerade"</span>: <span class="string">"true"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.bridge.host_binding_ipv4"</span>: <span class="string">"0.0.0.0"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.bridge.name"</span>: <span class="string">"docker0"</span>,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">            <span class="string">"com.docker.network.driver.mtu"</span>: <span class="string">"1500"</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">30</span></pre></td><td class="code"><pre><span class="line">        &#125;,</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">31</span></pre></td><td class="code"><pre><span class="line">        <span class="string">"Labels"</span>: &#123;&#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">32</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">33</span></pre></td><td class="code"><pre><span class="line">]</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">34</span></pre></td><td class="code"><pre><span class="line">root@adk:~<span class="comment">#</span></span></pre></td></tr></table></figure>

<h2 id="1-3-Host"><a href="#1-3-Host" class="headerlink" title="1.3 Host"></a>1.3 Host</h2><p>Containers sẽ dùng mạng trực tiếp của máy host. Network configuration bên trong container đồng nhất với host.</p>
<h2 id="2-User-defined-networks"><a href="#2-User-defined-networks" class="headerlink" title="2. User-defined networks"></a>2. User-defined networks</h2><p>Ngoài việc sử dụng các network mặc định do docker cung cấp. Ta có thể tự định nghĩa ra các dải network phù hợp<br>với công việc của mình.</p>
<p>Để tạo network, ta dùng lệnh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker network create --driver bridge --subnet 192.168.1.0/24 bridgexxx</span></pre></td></tr></table></figure>
<p>Trong đó:</p>
<ul>
<li><strong>–driver bridge</strong>: Chỉ định dải mạng mới được tạo ra sẽ thuộc kiểu nào: bridge, host, hay none.</li>
<li><strong>–subnet</strong>: Chỉ định địa địa chỉ mạng.</li>
<li><strong>bridgexxx</strong>: Tên của dải mạng mới.</li>
</ul>
<p>Khi chạy container chỉ định sử dụng 1 dải mạng đặc biệt, ta dùng lệnh</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker run --network=bridgexxx -itd --name=container3 busybox</span></pre></td></tr></table></figure>
<p>Trong đó:</p>
<ul>
<li><strong>–network=bridgexxx:</strong> Chỉ định ra dải mạng bridgexxx sẽ kết nối với container.</li>
</ul>
<p>Container mà bạn chạy trên network này đều phải thuộc về cùng một Docker host. Mỗi container trong network có thể communicate với các containers khác trong cùng network.</p>
<h2 id="3-An-overlay-network-with-Docker-Engine-swarm-mode"><a href="#3-An-overlay-network-with-Docker-Engine-swarm-mode" class="headerlink" title="3. An overlay network with Docker Engine swarm mode"></a>3. An overlay network with Docker Engine swarm mode</h2><ul>
<li>Overlay network là mạng có thể kết nối nhiều container trên các <strong>Docker Engine</strong> lại với nhau, trong môi trường cluster.</li>
<li>Swarm tạo ra overlay network chỉ available với các nodes bên trong swarm. Khi bạn tạo ra một service sử dụng overlay network, manager node sẽ tự động kế thừa overlay network tới các nodes chạy các service tasks.</li>
</ul>
<p>Ví dụ sau sẽ hướng dẫn cách tạo ra một network và sử dụng nó cho một service từ một manager node bên trong swarm:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create an overlay network `my-multi-host-network`.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">$ docker network create \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  --driver overlay \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  --subnet 10.0.9.0/24 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">  my-multi-host-network</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">400g6bwzd68jizzdx5pgyoe95</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create an nginx service and extend the my-multi-host-network to nodes where</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># the service's tasks run.</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">$ $ docker service create --replicas 2 --network my-multi-host-network --name my-web nginx</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">716thylsndqma81j6kkkb5aus</span></pre></td></tr></table></figure>

<h1 id="4-“Noi-chuyen”-giua-cac-container-voi-nhau"><a href="#4-“Noi-chuyen”-giua-cac-container-voi-nhau" class="headerlink" title="4. “Nói chuyện” giữa các container với nhau."></a>4. “Nói chuyện” giữa các container với nhau.</h1><ul>
<li>Trên cùng một host, các container chỉ cần dùng bridge network để nói chuyện được với nhau. Tuy nhiên, các container được cấp ip động nên nó có thể thay đổi, dẫn đến nhiều khó khăn. Vì vậy, thay vì dùng địa chỉ ip, ta có thể dùng name của các container để “liên lạc” giữa các container với nhau.</li>
<li>Trong trường hợp sử dụng default bridge network thì ta khai báo thêm lệnh <code>--link=name_container</code>.</li>
<li>Trong trường hợp sử dụng user-defined bridge network thì ta không cần phải link nữa.</li>
</ul>
<h2 id="4-1-Truong-hop-su-dung-default-bridge-network-de-ket-noi-cac-container"><a href="#4-1-Truong-hop-su-dung-default-bridge-network-de-ket-noi-cac-container" class="headerlink" title="4.1 Trường hợp sử dụng default bridge network để kết nối các container"></a>4.1 Trường hợp sử dụng default bridge network để kết nối các container</h2><ul>
<li>Giả sử ta có mô hình: <code>web - db</code></li>
<li>container web phải link được với container db. </li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker run -itd --name=db -e MYSQL_ROOT_PASSWORD=pass mysql:latest</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker run -itd --name=web --link=db nginx:latest</span></pre></td></tr></table></figure>

<ul>
<li>Kiểm tra: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it web sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping redis</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">PING redis (172.17.0.3): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.17.0.3: icmp_seq=0 ttl=64 time=0.245 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping db</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">PING db (172.17.0.2): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.17.0.2: icmp_seq=0 ttl=64 time=0.126 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">...</span></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="4-2-Truong-hop-su-dung-user-defined-bridge-network-de-ket-noi-cac-container"><a href="#4-2-Truong-hop-su-dung-user-defined-bridge-network-de-ket-noi-cac-container" class="headerlink" title="4.2 Trường hợp sử dụng user-defined bridge network để kết nối các container"></a>4.2 Trường hợp sử dụng user-defined bridge network để kết nối các container</h2><ul>
<li>Bạn không cần thực hiện thao tác link qua link lại giữa các container nữa.</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker network create my-net</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker network ls</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">716f591e185a        bridge              bridge              </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">4b0041303d6d        host                host                </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">7239bb9e0255        my-net              bridge              </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">016cf6ec1791        none                null</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">docker run -itd --name=web1 --net my-net nginx:latest</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">docker run -itd --name=db1 --net my-net -e MYSQL_ROOT_PASSWORD=pass mysql:latest</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it web1 sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping db1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">PING db1 (172.18.0.4): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.18.0.4: icmp_seq=0 ttl=64 time=0.161 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># ping redis1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">PING redis1 (172.18.0.3): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.18.0.3: icmp_seq=0 ttl=64 time=0.168 ms</span></pre></td></tr></table></figure>

<h2 id="5-DNS-server"><a href="#5-DNS-server" class="headerlink" title="5. DNS server."></a>5. DNS server.</h2><h3 id="5-1-Default-bridge-network"><a href="#5-1-Default-bridge-network" class="headerlink" title="5.1 Default bridge network"></a>5.1 Default bridge network</h3><ul>
<li>Khi container được chạy với network default bridge thì container sẽ sao chép nội dung file <code>/etc/resolv.conf</code> của host vào trong container. Do đó, dns-server được cấu hình trên máy host như thế nào, thì trên container tương tự như vậy.</li>
<li>Kiểm tra trên container:<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@292a65a743ac:/<span class="comment"># mount | grep /etc</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">/dev/disk/by-uuid/d9ed83b8-98cb-428a-9ad0-e7bf8ae36117 on /etc/resolv.conf <span class="built_in">type</span> ext4 (rw,relatime,errors=remount-ro,data=ordered)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">/dev/disk/by-uuid/d9ed83b8-98cb-428a-9ad0-e7bf8ae36117 on /etc/hostname <span class="built_in">type</span> ext4 (rw,relatime,errors=remount-ro,data=ordered)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">/dev/disk/by-uuid/d9ed83b8-98cb-428a-9ad0-e7bf8ae36117 on /etc/hosts <span class="built_in">type</span> ext4 (rw,relatime,errors=remount-ro,data=ordered)</span></pre></td></tr></table></figure>

</li>
</ul>
<p>=&gt; Ta thấy các file trên container được mount từ các file trên máy host.</p>
<ul>
<li>Kiểm tra nội dung file <code>resolv.conf</code><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@292a65a743ac:/<span class="comment"># cat /etc/resolv.conf </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"><span class="comment">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">nameserver 8.8.8.8</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">nameserver 8.8.4.4</span></pre></td></tr></table></figure>

</li>
</ul>
<p>=&gt; Tương tự trên máy host.</p>
<h3 id="5-2-User-defined-networks"><a href="#5-2-User-defined-networks" class="headerlink" title="5.2 User-defined networks"></a>5.2 User-defined networks</h3><ul>
<li><p>Docker sẽ sử dụng <code>built-in dns</code> riêng cho các container cùng 1 network.</p>
</li>
<li><p>Nội dung file <code>/etc/resolv.conf</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@07c8c10a7a81:/<span class="comment"># cat /etc/resolv.conf </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">nameserver 127.0.0.11</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">options ndots:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">root@07c8c10a7a81:/<span class="comment">#</span></span></pre></td></tr></table></figure>
</li>
<li><p>Docker chưa cung cấp công cụ để xem thông tin các record của built-in dns này.</p>
</li>
</ul>
<h3 id="5-3-Chi-dinh-su-dung-dns-server-rieng"><a href="#5-3-Chi-dinh-su-dung-dns-server-rieng" class="headerlink" title="5.3 Chỉ định sử dụng dns-server riêng"></a>5.3 Chỉ định sử dụng dns-server riêng</h3><ul>
<li>Dùng cờ <code>--dns</code>: để khai báo dns-server sẽ sử dụng trong container:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker2:/opt<span class="comment"># docker run -it --name hcm --dns=10.10.10.1 ubuntu /bin/bash</span></span></pre></td></tr></table></figure>

<h2 id="6-MacVlan"><a href="#6-MacVlan" class="headerlink" title="6. MacVlan."></a>6. MacVlan.</h2><p>Macvlan cho phép cấu hình sub-interfaces (hay còn gọi là slave devices) trên một Ethernet interface vật lý (còn gọi là upper device), mỗi sub-interfaces này có địa chỉ MAC riêng và do đó có địa chỉ IP riêng. Các ứng dụng, VM và các containers có thể kết nối với một sub-interface nhất định để kết nối trực tiếp với mạng vật lý, sử dụng địa chỉ MAC và địa chỉ IP riêng của chúng.</p>
<p><img alt data-src="https://raw.githubusercontent.com/hocchudong/ghichep-docker/master/hinhanh/macvlan.png" class="lazyload"></p>
<h4 id="LAB-macvlan-che-do-bridge"><a href="#LAB-macvlan-che-do-bridge" class="headerlink" title="LAB macvlan chế độ bridge"></a>LAB macvlan chế độ bridge</h4><p>Trong khi macvlan có 4 chế độ (VEPA, bridge, private, passthrough), thì Docker macvlan driver chỉ hỗ trợ macvlan bridge mode.</p>
<ul>
<li>Mô hình:</li>
</ul>
<p><img alt data-src="https://raw.githubusercontent.com/hocchudong/ghichep-docker/master/hinhanh/lab_macvlan.png" class="lazyload"></p>
<ul>
<li><p>Kiểm tra card mạng máy host</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># ifconfig -a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker0   Link encap:Ethernet  HWaddr 02:42:b5:a4:86:55  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">          UP BROADCAST MULTICAST  MTU:1500  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:0 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">eth0      Link encap:Ethernet  HWaddr 52:54:00:f6:70:7a  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">          inet addr:172.16.69.234  Bcast:172.16.69.255  Mask:255.255.255.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">          inet6 addr: fe80::5054:ff:fef6:707a/64 Scope:Link</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">          RX packets:754142 errors:0 dropped:4 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">          TX packets:225721 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:1000 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">          RX bytes:87515346 (87.5 MB)  TX bytes:34434449 (34.4 MB)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">lo        Link encap:Local Loopback  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">          inet6 addr: ::1/128 Scope:Host</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">          RX packets:6 errors:0 dropped:0 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:0 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">          RX bytes:576 (576.0 B)  TX bytes:576 (576.0 B)</span></pre></td></tr></table></figure>
</li>
<li><p>Tạo card mạng macvlan chế độ bridge</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker network create -d macvlan --subnet 172.16.69.0/24 --gateway 172.16.69.1 --ip-range=172.16.69.240/28 -o parent=eth0 macvlan0</span></span></pre></td></tr></table></figure>
<p>Trong đó:</p>
<ul>
<li>subnet và gateway: chỉ ra dải địa chỉ mạng thật.</li>
<li>ip-range: Chỉ ra dải địa chỉ sẽ được cấp cho container.</li>
</ul>
</li>
<li><p>Kiểm tra card mạng vừa tạo</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker network ls</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">89aacb502e1e        bridge              bridge              <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">d1b81f6ed217        docker_gwbridge     bridge              <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">e1ea5196a974        host                host                <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">re92zy5a0lvn        ingress             overlay             swarm</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">bf347a55a5a4        macvlan0            macvlan             <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">120c2a080b4f        none                null                <span class="built_in">local</span></span></pre></td></tr></table></figure>
</li>
<li><p>Tạo container1 và gắn vào card mạng vừa tạo</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker run -it --net macvlan0 --name alpine1 alpine /bin/sh</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">24: eth0@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    link/ether 02:42:ac:10:45:f0 brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    inet 172.16.69.240/24 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::42:acff:fe10:45f0/64 scope link tentative </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>
</li>
<li><p>Kiểm tra ping gateway và ping ra ngoài internet</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 172.16.69.1</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">PING 172.16.69.1 (172.16.69.1): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.1: seq=0 ttl=64 time=0.856 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.1: seq=1 ttl=64 time=0.580 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">--- 172.16.69.1 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 0.580/0.718/0.856 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 8.8.8.8</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">64 bytes from 8.8.8.8: seq=0 ttl=45 time=40.851 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">--- 8.8.8.8 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">1 packets transmitted, 1 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 40.851/40.851/40.851 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># </span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># exit</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment">#</span></span></pre></td></tr></table></figure>
</li>
<li><p>Tạo container2 và gắn vào card mạng vừa tạo</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker run -it --net macvlan0 --name alpine2 alpine /bin/sh</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">25: eth0@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    link/ether 02:42:ac:10:45:f1 brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    inet 172.16.69.241/24 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::42:acff:fe10:45f1/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>
</li>
<li><p>Ping container1, google</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 172.16.69.240</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">PING 172.16.69.240 (172.16.69.240): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.240: seq=0 ttl=64 time=0.349 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.240: seq=1 ttl=64 time=0.139 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.240: seq=2 ttl=64 time=0.090 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">64 bytes from 172.16.69.240: seq=3 ttl=64 time=0.282 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">--- 172.16.69.240 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">4 packets transmitted, 4 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 0.090/0.215/0.349 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 8.8.8.8</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">PING 8.8.8.8 (8.8.8.8): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">64 bytes from 8.8.8.8: seq=0 ttl=45 time=32.703 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">64 bytes from 8.8.8.8: seq=1 ttl=45 time=32.804 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">64 bytes from 8.8.8.8: seq=2 ttl=45 time=32.803 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">64 bytes from 8.8.8.8: seq=3 ttl=45 time=32.768 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">--- 8.8.8.8 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">4 packets transmitted, 4 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 32.703/32.769/32.804 ms</span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="LAB-macvlan-che-do-bridge-tinh-nang-vlan"><a href="#LAB-macvlan-che-do-bridge-tinh-nang-vlan" class="headerlink" title="LAB macvlan chế độ bridge tính năng vlan"></a>LAB macvlan chế độ bridge tính năng vlan</h4><ul>
<li><p>Tính năng vlan sẽ phân chia các containers nằm trên từng vlan khác nhau. Giúp chúng ta dễ dàng quản lý các container.</p>
</li>
<li><p>Định dạng của vlan sub-interface là <code>interface_name.vlan_tag</code>. Ví dụ: <strong>eth0.50</strong></p>
</li>
<li><p>Mô hình:</p>
</li>
</ul>
<p><img alt data-src="https://raw.githubusercontent.com/hocchudong/ghichep-docker/master/hinhanh/macvlan-vlan.png" class="lazyload"></p>
<ul>
<li><p>Tạo network với <code>vlan tag</code> là <code>50</code> dựa trên interface <code>eth0</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker network  create  -d macvlan \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    --subnet=192.168.50.0/24 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    --gateway=192.168.50.1 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    -o parent=eth0.50 macvlan50</span></pre></td></tr></table></figure></li>
<li><p>Tạo 2 containers dùng card mạng này: </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan50 -it --name macvlan_test5 --rm alpine /bin/sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan50 -it --name macvlan_test6 --rm alpine /bin/sh</span></pre></td></tr></table></figure>
</li>
<li><p>Tạo network với <code>vlan tag</code> là <code>60</code> dựa trên interface <code>eth0</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker network  create  -d macvlan \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    --subnet=192.168.60.0/24 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    --gateway=192.168.60.1 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    -o parent=eth0.60 -o \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    --macvlan_mode=bridge macvlan60</span></pre></td></tr></table></figure></li>
<li><p>Tạo 2 containers:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan60 -it --name macvlan_test7 --rm alpine /bin/sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan60 -it --name macvlan_test8 --rm alpine /bin/sh</span></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="Kiem-tra"><a href="#Kiem-tra" class="headerlink" title="Kiểm tra"></a>Kiểm tra</h5><ul>
<li><p>Sau khi tạo 2 macvlan, ta thấy xuất hiện 2 sub-interface tương ứng là: <code>eth0.50@eth0</code> và <code>eth0.60@eth0</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># ip a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    link/ether 52:54:00:f6:70:7a brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    inet 172.16.69.234/24 brd 172.16.69.255 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::5054:ff:fef6:707a/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">    link/ether 02:42:b5:a4:86:55 brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">    inet 172.17.0.1/16 scope global docker0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">33: eth0.50@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">    link/ether 52:54:00:f6:70:7a brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::5054:ff:fef6:707a/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">36: eth0.60@eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">    link/ether 52:54:00:f6:70:7a brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::5054:ff:fef6:707a/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr></table></figure>
</li>
<li><p>Trên containers <code>macvlan_test5</code> ping đến containers <code>macvlan_test6</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">34: eth0@if33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    link/ether 02:42:c0:a8:32:02 brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    inet 192.168.50.2/24 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::42:c0ff:fea8:3202/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 192.168.50.3</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">PING 192.168.50.3 (192.168.50.3): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.50.3: seq=0 ttl=64 time=0.357 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.50.3: seq=1 ttl=64 time=0.107 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">--- 192.168.50.3 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">2 packets transmitted, 2 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 0.107/0.232/0.357 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>
</li>
<li><p>Trên containers <code>macvlan_test5</code> ping đến containers <code>macvlan_test7</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 192.168.60.2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">PING 192.168.60.2 (192.168.60.2): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">--- 192.168.60.2 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">21 packets transmitted, 0 packets received, 100% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="Tao-multi-subnet-tren-cung-1-sub-interface"><a href="#Tao-multi-subnet-tren-cung-1-sub-interface" class="headerlink" title="Tạo multi-subnet trên cùng 1 sub-interface:"></a>Tạo multi-subnet trên cùng 1 sub-interface:</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment">### Create multiple bridge subnets with a gateway of x.x.x.1:</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker network  create  -d macvlan \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">  --subnet=192.168.164.0/24 --subnet=192.168.166.0/24 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">  --gateway=192.168.164.1  --gateway=192.168.166.1 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">   -o parent=eth0.166 \</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">   -o macvlan_mode=bridge macvlan64</span></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan64 --name=macnet54_test --ip=192.168.164.10 -itd alpine /bin/sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan64 --name=macnet55_test --ip=192.168.166.10 -itd alpine /bin/sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan64 --ip=192.168.164.11 -it --rm alpine /bin/sh</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">docker run --net=macvlan64 --ip=192.168.166.11 -it --rm alpine /bin/sh</span></pre></td></tr></table></figure>

<ul>
<li>Khi tạo containers phải chỉ định rõ là sử dụng subnet nào.</li>
<li><strong>Mặc dù cùng 1 sub-interface nhưng các containers chỉ có thể nói chuyện với nhau nếu nó nằm cùng 1 subnet.</strong></li>
</ul>
<h2 id="7-Ipvlan"><a href="#7-Ipvlan" class="headerlink" title="7. Ipvlan"></a>7. Ipvlan</h2><p>Ipvlan khá giống so với macvlan, tuy nhiên nó có điểm khác so với macvlan là không gán địa chỉ MAC riêng cho các sub-interfaces. Các sub-interfaces chia sẻ chung địa chỉ MAC với parent interfaces (card vật lý trên đó tạo các sub-interfaces), nhưng có địa chỉ IP riêng.</p>
<p><img alt data-src="https://raw.githubusercontent.com/hocchudong/ghichep-docker/master/hinhanh/ipvlan.png" class="lazyload"></p>
<ul>
<li><p>Ipvlan L2: Ipvlan L2 hay Layer 2 mode tương tự với chế độ macvlan bridge mode.</p>
</li>
<li><p>Ipvlan L3: Ipvlan L2 được coi coi như bridge hay switch giữa các sub-interfaces và parent interface. Tương tự như vậy, Ipvlan L3 hay Layer 3 mode được coi như thiết bị lớp 3 (như router) giữa các sub-interfaces và parent interfaces.</p>
</li>
<li><p>Thông tin về macvlan và ipvlan sẽ cập nhật bài viết sau.</p>
</li>
<li><p><strong>Lab ipvlan mode 2 khá tương tự với phần macvlan chế độ bridge nên tôi sẽ không đề cập tại đây</strong><br>s</p>
</li>
<li><p>Để sử dụng được chế độ ipvlan, các bạn phải kích hoạt tính năng <strong>Experimental</strong> và nên update lên kernel mới nhất:</p>
<ul>
<li><p>Tạo file <code>/etc/docker/daemon.json</code> với nội dung:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">"experimental"</span>: <span class="literal">true</span> &#125;</span></pre></td></tr></table></figure>
</li>
<li><p>Khởi động lại docker: <code>service docker restart</code></p>
<ul>
<li>Kiểm tra: Nếu trả về true là ok.<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">$ docker version -f <span class="string">'&#123;&#123;.Server.Experimental&#125;&#125;'</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="literal">true</span></span></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Lab-ipvlan-L3-Multi-Subnet-Ipvlan-L3-Network"><a href="#Lab-ipvlan-L3-Multi-Subnet-Ipvlan-L3-Network" class="headerlink" title="Lab ipvlan L3: Multi-Subnet Ipvlan L3 Network"></a>Lab ipvlan L3: Multi-Subnet Ipvlan L3 Network</h4><ul>
<li>Mô hình</li>
</ul>
<p><img alt data-src="https://raw.githubusercontent.com/hocchudong/ghichep-docker/master/hinhanh/ipvlan_l3.png" class="lazyload"></p>
<ul>
<li><p>Kiểm tra card mạng máy host</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># ifconfig -a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">docker0   Link encap:Ethernet  HWaddr 02:42:b5:a4:86:55  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">          inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">          UP BROADCAST MULTICAST  MTU:1500  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:0 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">eth0      Link encap:Ethernet  HWaddr 52:54:00:f6:70:7a  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">          inet addr:172.16.69.234  Bcast:172.16.69.255  Mask:255.255.255.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">          inet6 addr: fe80::5054:ff:fef6:707a/64 Scope:Link</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">          RX packets:754142 errors:0 dropped:4 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">          TX packets:225721 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:1000 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">          RX bytes:87515346 (87.5 MB)  TX bytes:34434449 (34.4 MB)</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">lo        Link encap:Local Loopback  </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">          inet6 addr: ::1/128 Scope:Host</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">          RX packets:6 errors:0 dropped:0 overruns:0 frame:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">          TX packets:6 errors:0 dropped:0 overruns:0 carrier:0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">          collisions:0 txqueuelen:0 </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">          RX bytes:576 (576.0 B)  TX bytes:576 (576.0 B)</span></pre></td></tr></table></figure>
</li>
<li><p>Tạo network</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker network create -d ipvlan --subnet=192.168.100.0/24 --gateway=192.168.100.1 --subnet=192.168.200.0/24 --gateway=192.168.200.1 -o parent=eth0 -o ipvlan_mode=l3 ipvlan</span></span></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker network ls</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">20504846ae2b        bridge              bridge              <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">e1ea5196a974        host                host                <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">0f6b33a6df54        ipvlan              ipvlan              <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">120c2a080b4f        none                null                <span class="built_in">local</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment">#</span></span></pre></td></tr></table></figure>

<ul>
<li>tạo container1 với subnet 192.168.100.0/24<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker run -it --name ipvlan_c1 --net=ipvlan --ip=192.168.100.2 alpine /bin/sh</span></span></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">31: eth0@if2: &lt;BROADCAST,MULTICAST,NOARP,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    link/ether 52:54:00:f6:70:7a brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    inet 192.168.100.2/24 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::5054:ff:fef6:707a/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>

<p><strong>=&gt; cùng mac với máy host</strong></p>
<ul>
<li>tạo container2 với subnet 192.168.200.0/24<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">root@docker4:~<span class="comment"># docker run -it --name ipvlan_c2 --net=ipvlan --ip=192.168.200.2 alpine /bin/sh</span></span></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ip a</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">    inet 127.0.0.1/8 scope host lo</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    inet6 ::1/128 scope host </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">32: eth0@if2: &lt;BROADCAST,MULTICAST,NOARP,UP,LOWER_UP,M-DOWN&gt; mtu 1500 qdisc noqueue state UNKNOWN </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">    link/ether 52:54:00:f6:70:7a brd ff:ff:ff:ff:ff:ff</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    inet 192.168.200.2/24 scope global eth0</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    inet6 fe80::5054:ff:fef6:707a/64 scope link </span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">       valid_lft forever preferred_lft forever</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>

<p><strong>=&gt; cùng mac với máy host</strong></p>
<ul>
<li>Trên container2 ping container1<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping 192.168.100.2</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">PING 192.168.100.2 (192.168.100.2): 56 data bytes</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=0 ttl=64 time=0.399 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=1 ttl=64 time=0.095 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=2 ttl=64 time=0.091 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=3 ttl=64 time=0.104 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=4 ttl=64 time=0.100 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">64 bytes from 192.168.100.2: seq=5 ttl=64 time=0.292 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">^C</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">--- 192.168.100.2 ping statistics ---</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">6 packets transmitted, 6 packets received, 0% packet loss</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">round-trip min/avg/max = 0.091/0.180/0.399 ms</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">/ <span class="comment">#</span></span></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><ul>
<li><a href="https://gist.github.com/nerdalert/c0363c15d20986633fda" target="_blank" rel="noopener">https://gist.github.com/nerdalert/c0363c15d20986633fda</a></li>
<li><a href="http://www.dasblinkenlichten.com/docker-networking-101-host-mode/" target="_blank" rel="noopener">http://www.dasblinkenlichten.com/docker-networking-101-host-mode/</a></li>
<li><a href="https://viblo.asia/euclid/posts/XqakEmmbkWK" target="_blank" rel="noopener">https://viblo.asia/euclid/posts/XqakEmmbkWK</a></li>
<li><a href="https://docs.docker.com/engine/userguide/networking/#the-dockergwbridge-network" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/#the-dockergwbridge-network</a></li>
<li><a href="https://kipalog.com/posts/Cach-lien-ket-cac-container-lai-voi-nhau-trong-docker" target="_blank" rel="noopener">https://kipalog.com/posts/Cach-lien-ket-cac-container-lai-voi-nhau-trong-docker</a></li>
<li><a href="https://docs.docker.com/engine/userguide/networking/get-started-macvlan/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/networking/get-started-macvlan/</a></li>
<li><a href="https://www.slideshare.net/bbsali0/docker-networking-with-new-ipvlan-and-macvlan-drivers" target="_blank" rel="noopener">https://www.slideshare.net/bbsali0/docker-networking-with-new-ipvlan-and-macvlan-drivers</a></li>
<li><a href="https://hicu.be/docker-networking-macvlan-bridge-mode-configuration" target="_blank" rel="noopener">https://hicu.be/docker-networking-macvlan-bridge-mode-configuration</a></li>
<li><a href="https://hicu.be/docker-container-network-types" target="_blank" rel="noopener">https://hicu.be/docker-container-network-types</a></li>
<li><a href="https://sreeninet.wordpress.com/2016/05/29/docker-macvlan-and-ipvlan-network-plugins/" target="_blank" rel="noopener">https://sreeninet.wordpress.com/2016/05/29/docker-macvlan-and-ipvlan-network-plugins/</a></li>
<li><a href="https://sreeninet.wordpress.com/2016/05/29/macvlan-and-ipvlan/" target="_blank" rel="noopener">https://sreeninet.wordpress.com/2016/05/29/macvlan-and-ipvlan/</a></li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">Eopi Noriko</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="/https:/eopi.loliteam.net/2019/12/05/docker5/">https://eopi.loliteam.net/2019/12/05/docker5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker    </a><a class="post-meta__tags" href="/tags/Virtual-Machine/">Virtual Machine    </a></div><div class="post_share"><div class="social-share" data-image="/img/docker.png" data-sites="facebook,twitter"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2019/12/05/docker6/"><img class="prev_cover lazyload" data-src="/img/docker.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Bài đăng trước</div><div class="prev_info"><span>6. Viết docker-compose để khởi chạy multi container</span></div></a></div><div class="next-post pull_right"><a href="/2019/12/05/docker4/"><img class="next_cover lazyload" data-src="/img/docker.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Bài tiếp theo</div><div class="next_info"><span>4. Viết dockerfile để build image</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2019/12/05/docker1/" title="1. Cài đặt docker engine cơ bản (Cài đặt môi trường lab)"><img class="relatedPosts_cover lazyload"data-src="/img/docker.png"><div class="relatedPosts_title">1. Cài đặt docker engine cơ bản (Cài đặt môi trường lab)</div></a></div><div class="relatedPosts_item"><a href="/2019/12/05/docker2/" title="2. Các ghi chép cần chú ý về docker"><img class="relatedPosts_cover lazyload"data-src="/img/docker.png"><div class="relatedPosts_title">2. Các ghi chép cần chú ý về docker</div></a></div><div class="relatedPosts_item"><a href="/2019/12/05/docker3/" title="3. Docker image"><img class="relatedPosts_cover lazyload"data-src="/img/docker.png"><div class="relatedPosts_title">3. Docker image</div></a></div></div><div class="clear_both"></div></div></div></div><footer id="footer" style="background-image: url(/img/docker.png)"><div id="footer-wrap"><div class="copyright">&copy;2019 By Eopi Noriko</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script async src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.15/dist/snackbar.min.js"></script><script id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.7" zIndex="-1" mobile="true" data-click="true"></script><script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true; // make power mode colorful
POWERMODE.shake = true; // turn off shake
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><script src="/js/third-party/click_heart.js"></script><script src="/js/third-party/ClickShowText.js"></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Tìm Kiếm</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Tìm kiếm Bài viết"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>